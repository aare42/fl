<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–µ–π—Å–∏ - –ö–µ–π—Å–∏ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Cases Page Specific Styles */
    .cases-page {
      background-color: var(--bg-light);
      min-height: 100vh;
    }

    .cases-header {
      background-color: white;
      padding: 2rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .cases-header-content {
      max-width: 1300px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .cases-header h1 {
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
    }

    .cases-header p {
      color: var(--text-gray);
      font-size: 0.9375rem;
    }

    .cases-container {
      max-width: 1300px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Filter Section */
    .filter-area {
      background: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }

    .filter-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.625rem;
    }

    .filter-tag {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 0.375rem;
      background: white;
      color: var(--text-dark);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-tag:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .filter-tag.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .active-filters {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
      display: none;
    }

    .active-filters.show {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .active-filters-label {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-gray);
    }

    .active-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      background: var(--primary-color);
      color: white;
      border-radius: 1rem;
      font-size: 0.8125rem;
      font-weight: 500;
    }

    .active-tag button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      padding: 0;
      line-height: 1;
    }

    .clear-filters {
      padding: 0.25rem 0.75rem;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 1rem;
      font-size: 0.8125rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .clear-filters:hover {
      background: var(--bg-light);
    }

    /* Cases Grid */
    .cases-grid-new {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .case-card-new {
      background: white;
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    }

    .case-card-new:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    .case-thumbnail {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
      position: relative;
      overflow: hidden;
    }

    .case-thumbnail iframe {
      width: 100%;
      height: 300%;
      border: none;
      pointer-events: none;
      transform: scale(0.5);
      transform-origin: top left;
      overflow: hidden;
    }

    .case-thumbnail::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));
      pointer-events: none;
    }

    .case-thumbnail-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: white;
    }

    .case-thumbnail-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .case-thumbnail-type {
      font-size: 0.8125rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.9;
    }

    .case-body {
      padding: 1.25rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .case-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .case-description {
      font-size: 0.875rem;
      color: var(--text-gray);
      line-height: 1.5;
      margin-bottom: 1rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex: 1;
    }

    .case-info {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.8125rem;
      color: var(--text-gray);
      flex-wrap: wrap;
    }

    .case-info-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .case-tags-new {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-bottom: 1rem;
      min-height: 24px;
    }

    .case-tag-new {
      padding: 0.25rem 0.625rem;
      background: rgba(64, 186, 141, 0.1);
      color: var(--primary-color);
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .case-actions-new {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .download-btn {
      height: 36px;
      padding: 0 1rem;
      border: none;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background: var(--primary-color);
      color: white;
      white-space: nowrap;
    }

    .download-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(64, 186, 141, 0.3);
    }

    .download-icon {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    .share-section {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      flex: 1;
    }

    .share-label {
      font-size: 0.75rem;
      color: var(--text-gray);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .share-btns {
      display: flex;
      gap: 0.375rem;
    }

    .share-btn-mini {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.25rem;
      text-decoration: none;
      color: white;
      font-size: 0.875rem;
      transition: all 0.2s;
      font-weight: 600;
    }

    .share-btn-mini:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .share-btn-mini.facebook {
      background-color: #1877f2;
    }

    .share-btn-mini.twitter {
      background-color: #1da1f2;
    }

    .share-btn-mini.linkedin {
      background-color: #0a66c2;
    }

    .share-btn-mini.telegram {
      background-color: #0088cc;
    }

    /* Empty state */
    .cases-empty {
      text-align: center;
      padding: 4rem 2rem;
      background: white;
      border-radius: 0.5rem;
    }

    .cases-empty h3 {
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
    }

    .cases-empty p {
      color: var(--text-gray);
    }

    /* Loading */
    .cases-loading {
      text-align: center;
      padding: 3rem;
    }

    @media (max-width: 768px) {
      .cases-header-content,
      .cases-container {
        padding-left: 1rem;
        padding-right: 1rem;
      }

      .cases-grid-new {
        grid-template-columns: 1fr;
      }

      .filter-area {
        padding: 1rem;
      }

      .case-actions-new {
        flex-wrap: wrap;
      }

      .share-section {
        width: 100%;
      }

      .download-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body class="cases-page">
  <header>
    <nav>
      <h1>–ö–µ–π—Å–∏ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ</h1>
      <ul>
        <li><a href="/">–ì–æ–ª–æ–≤–Ω–∞</a></li>
        <li><a href="/cases">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–µ–π—Å–∏</a></li>
      </ul>
    </nav>
  </header>

  <div class="cases-header">
    <div class="cases-header-content">
      <h1>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–µ–π—Å–∏ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ</h1>
      <p>–†–µ–∞–ª—å–Ω—ñ –∫–µ–π—Å–∏ –≤—ñ–¥ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π, –∞–¥–∞–ø—Ç–æ–≤–∞–Ω—ñ –¥–ª—è –æ—Å–≤—ñ—Ç–∏</p>
    </div>
  </div>

  <div class="cases-container">
    <div class="filter-area">
      <div class="filter-title">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞ —Ç–µ–º–∞–º–∏</div>
      <div class="filter-tags" id="filter-tags"></div>

      <div class="active-filters" id="active-filters">
        <span class="active-filters-label">–ê–∫—Ç–∏–≤–Ω—ñ:</span>
        <div id="active-tags-list"></div>
        <button class="clear-filters" onclick="clearAllFilters()">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
      </div>
    </div>

    <div id="cases-content">
      <div class="cases-loading">
        <div class="spinner"></div>
      </div>
    </div>
  </div>


  <script>
    let allTags = [];
    let selectedTags = [];
    let allCases = [];

    // Load tags
    async function loadTags() {
      try {
        const response = await fetch('/api/cases/meta/tags');
        allTags = await response.json();

        const filterTagsContainer = document.getElementById('filter-tags');
        filterTagsContainer.innerHTML = allTags.map(tag => `
          <button class="filter-tag" data-tag="${tag.name}" onclick="toggleFilterTag('${tag.name}')">
            ${tag.name}
          </button>
        `).join('');
      } catch (error) {
        console.error('Error loading tags:', error);
      }
    }

    // Toggle filter tag
    function toggleFilterTag(tagName) {
      const index = selectedTags.indexOf(tagName);
      if (index > -1) {
        selectedTags.splice(index, 1);
      } else {
        selectedTags.push(tagName);
      }
      updateFilterUI();
      loadCases();
    }

    // Update filter UI
    function updateFilterUI() {
      // Update filter tag buttons
      document.querySelectorAll('.filter-tag').forEach(btn => {
        const tag = btn.getAttribute('data-tag');
        if (selectedTags.includes(tag)) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      // Update active filters display
      const activeFiltersContainer = document.getElementById('active-filters');
      const activeTagsList = document.getElementById('active-tags-list');

      if (selectedTags.length > 0) {
        activeFiltersContainer.classList.add('show');
        activeTagsList.innerHTML = selectedTags.map(tag => `
          <span class="active-tag">
            ${tag}
            <button onclick="toggleFilterTag('${tag}')">&times;</button>
          </span>
        `).join('');
      } else {
        activeFiltersContainer.classList.remove('show');
      }
    }

    // Clear all filters
    function clearAllFilters() {
      selectedTags = [];
      updateFilterUI();
      loadCases();
    }

    // Load cases
    async function loadCases() {
      try {
        let url = '/api/cases';
        if (selectedTags.length > 0) {
          url += '?tags=' + selectedTags.join(',');
        }

        const response = await fetch(url);
        allCases = await response.json();
        displayCases(allCases);
      } catch (error) {
        console.error('Error loading cases:', error);
        document.getElementById('cases-content').innerHTML = `
          <div class="cases-empty">
            <h3>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–µ–π—Å—ñ–≤</h3>
            <p>–ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.</p>
          </div>
        `;
      }
    }

    // Display cases
    function displayCases(cases) {
      const casesContent = document.getElementById('cases-content');

      if (cases.length === 0) {
        casesContent.innerHTML = `
          <div class="cases-empty">
            <h3>–ö–µ–π—Å–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —ñ–Ω—à—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ –∞–±–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∫–µ–π—Å–∏.</p>
          </div>
        `;
        return;
      }

      casesContent.innerHTML = `
        <div class="cases-grid-new">
          ${cases.map(c => `
            <div class="case-card-new">
              <div class="case-thumbnail">
                ${c.file_type === '.pdf' ? `
                  <iframe src="/${c.file_path}#toolbar=0&navpanes=0&scrollbar=0" loading="lazy"></iframe>
                ` : `
                  <div class="case-thumbnail-placeholder">
                    <div class="case-thumbnail-icon">üìÑ</div>
                    <div class="case-thumbnail-type">–§–∞–π–ª ${c.file_type.replace('.', '').toUpperCase()}</div>
                  </div>
                `}
              </div>
              <div class="case-body">
                <div class="case-title">${c.name}</div>
                ${c.description ? `<div class="case-description">${c.description}</div>` : '<div class="case-description" style="min-height: 0;"></div>'}
                <div class="case-info">
                  ${c.organization_name ? `
                    <div class="case-info-item">
                      <strong>–ü–∞—Ä—Ç–Ω–µ—Ä:</strong> ${c.organization_name}
                    </div>
                  ` : ''}
                  <div class="case-info-item">
                    <strong>–§–æ—Ä–º–∞—Ç:</strong> ${c.file_type.replace('.', '').toUpperCase()}
                  </div>
                </div>
                <div class="case-tags-new">
                  ${c.tags && c.tags.length > 0 ? c.tags.map(tag => `
                    <span class="case-tag-new">${tag}</span>
                  `).join('') : ''}
                </div>
                <div class="case-actions-new">
                  <a href="/${c.file_path}" download class="download-btn" title="–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏">
                    <svg class="download-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 15.577l-3.539-3.538.708-.72L11.5 13.65V5h1v8.65l2.331-2.331.708.72L12 15.577z"/>
                      <path d="M19 18v-5h1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-5h1v5h14z"/>
                    </svg>
                    –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                  </a>
                  <div class="share-section">
                    <span class="share-label">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è:</span>
                    <div class="share-btns">
                      <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}"
                         target="_blank"
                         class="share-btn-mini facebook"
                         title="Share on Facebook">f</a>
                      <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(c.name)}&url=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}"
                         target="_blank"
                         class="share-btn-mini twitter"
                         title="Share on Twitter">ùïè</a>
                      <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}"
                         target="_blank"
                         class="share-btn-mini linkedin"
                         title="Share on LinkedIn">in</a>
                      <a href="https://t.me/share/url?url=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}&text=${encodeURIComponent(c.name)}"
                         target="_blank"
                         class="share-btn-mini telegram"
                         title="Share on Telegram">‚úàÔ∏è</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Initialize
    loadTags();
    loadCases();
  </script>
</body>
</html>
