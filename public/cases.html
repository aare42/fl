<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–µ–π—Å–∏ - –ö–µ–π—Å–∏ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#40ba8d',
            'primary-dark': '#359a75',
            secondary: '#CE2A1E',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50">
  <!-- Navigation -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <h1 class="text-xl font-semibold text-gray-900">–ö–µ–π—Å–∏ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ</h1>
        <ul class="flex space-x-8">
          <li><a href="/" class="text-gray-700 hover:text-primary transition">–ì–æ–ª–æ–≤–Ω–∞</a></li>
          <li><a href="/cases" class="text-primary font-medium hover:text-primary-dark transition">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–µ–π—Å–∏</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <!-- Page Header -->
  <div class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–µ–π—Å–∏ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—ñ</h1>
      <p class="text-gray-600">–†–µ–∞–ª—å–Ω—ñ –∫–µ–π—Å–∏ –≤—ñ–¥ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π, –∞–¥–∞–ø—Ç–æ–≤–∞–Ω—ñ –¥–ª—è –æ—Å–≤—ñ—Ç–∏</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Filters -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
      <h2 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-4">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞ —Ç–µ–º–∞–º–∏</h2>
      <div id="filter-tags" class="flex flex-wrap gap-2 mb-4"></div>

      <!-- Active Filters -->
      <div id="active-filters" class="hidden pt-4 border-t border-gray-200">
        <div class="flex flex-wrap items-center gap-3">
          <span class="text-sm font-medium text-gray-600">–ê–∫—Ç–∏–≤–Ω—ñ:</span>
          <div id="active-tags-list" class="flex flex-wrap gap-2"></div>
          <button onclick="clearAllFilters()" class="text-sm text-gray-600 hover:text-gray-900 underline">
            –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ
          </button>
        </div>
      </div>
    </div>

    <!-- Cases Grid -->
    <div id="cases-content">
      <div class="flex justify-center items-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
      </div>
    </div>
  </div>

  <script>
    let allTags = [];
    let selectedTags = [];
    let allCases = [];

    // Load tags
    async function loadTags() {
      try {
        const response = await fetch('/api/cases/meta/tags');
        allTags = await response.json();

        const filterTagsContainer = document.getElementById('filter-tags');
        filterTagsContainer.innerHTML = allTags.map(tag => `
          <button
            class="filter-tag px-4 py-2 rounded-lg border-2 border-gray-200 text-gray-700 font-medium hover:border-primary hover:text-primary transition"
            data-tag="${tag.name}"
            onclick="toggleFilterTag('${tag.name}')">
            ${tag.name}
          </button>
        `).join('');
      } catch (error) {
        console.error('Error loading tags:', error);
      }
    }

    // Toggle filter tag
    function toggleFilterTag(tagName) {
      const index = selectedTags.indexOf(tagName);
      if (index > -1) {
        selectedTags.splice(index, 1);
      } else {
        selectedTags.push(tagName);
      }
      updateFilterUI();
      loadCases();
    }

    // Update filter UI
    function updateFilterUI() {
      // Update filter tag buttons
      document.querySelectorAll('.filter-tag').forEach(btn => {
        const tag = btn.getAttribute('data-tag');
        if (selectedTags.includes(tag)) {
          btn.className = 'filter-tag px-4 py-2 rounded-lg border-2 border-primary bg-primary text-white font-medium transition';
        } else {
          btn.className = 'filter-tag px-4 py-2 rounded-lg border-2 border-gray-200 text-gray-700 font-medium hover:border-primary hover:text-primary transition';
        }
      });

      // Update active filters display
      const activeFiltersContainer = document.getElementById('active-filters');
      const activeTagsList = document.getElementById('active-tags-list');

      if (selectedTags.length > 0) {
        activeFiltersContainer.classList.remove('hidden');
        activeTagsList.innerHTML = selectedTags.map(tag => `
          <span class="inline-flex items-center gap-2 px-3 py-1 bg-primary text-white rounded-full text-sm font-medium">
            ${tag}
            <button onclick="toggleFilterTag('${tag}')" class="hover:bg-primary-dark rounded-full p-0.5 transition">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </span>
        `).join('');
      } else {
        activeFiltersContainer.classList.add('hidden');
      }
    }

    // Clear all filters
    function clearAllFilters() {
      selectedTags = [];
      updateFilterUI();
      loadCases();
    }

    // Load cases
    async function loadCases() {
      try {
        let url = '/api/cases';
        if (selectedTags.length > 0) {
          url += '?tags=' + selectedTags.join(',');
        }

        const response = await fetch(url);
        allCases = await response.json();
        displayCases(allCases);
      } catch (error) {
        console.error('Error loading cases:', error);
        document.getElementById('cases-content').innerHTML = `
          <div class="text-center py-12">
            <p class="text-xl font-semibold text-gray-900 mb-2">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–µ–π—Å—ñ–≤</p>
            <p class="text-gray-600">–ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.</p>
          </div>
        `;
      }
    }

    // Display cases
    function displayCases(cases) {
      const casesContent = document.getElementById('cases-content');

      if (cases.length === 0) {
        casesContent.innerHTML = `
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <p class="text-xl font-semibold text-gray-900 mb-2">–ö–µ–π—Å–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>
            <p class="text-gray-600">–°–ø—Ä–æ–±—É–π—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —ñ–Ω—à—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ –∞–±–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∫–µ–π—Å–∏.</p>
          </div>
        `;
        return;
      }

      casesContent.innerHTML = `
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
          ${cases.map(c => `
            <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden flex flex-col">
              <!-- Preview -->
              <div class="h-48 bg-gradient-to-br from-primary to-primary-dark relative overflow-hidden">
                ${c.file_type === '.pdf' ? `
                  <div class="absolute inset-0 flex items-center justify-center">
                    <svg class="w-16 h-16 text-white/40" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <div class="absolute bottom-0 left-0 right-0 h-1/3 bg-gradient-to-t from-black/20 to-transparent"></div>
                ` : `
                  <div class="absolute inset-0 flex flex-col items-center justify-center text-white">
                    <svg class="w-16 h-16 mb-2 opacity-40" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-sm font-semibold uppercase tracking-wider">${c.file_type.replace('.', '')}</span>
                  </div>
                `}
              </div>

              <!-- Content -->
              <div class="p-5 flex-1 flex flex-col">
                <h3 class="text-lg font-semibold text-gray-900 mb-3 line-clamp-2">${c.name}</h3>

                ${c.description ? `<p class="text-sm text-gray-600 mb-4 line-clamp-2">${c.description}</p>` : ''}

                <!-- Meta Info -->
                <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm text-gray-600 mb-4 pb-4 border-b border-gray-100">
                  ${c.organization_name ? `
                    <div class="flex items-center gap-1">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                      </svg>
                      <span>${c.organization_name}</span>
                    </div>
                  ` : ''}
                  <div class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    <span>${c.file_type.replace('.', '').toUpperCase()}</span>
                  </div>
                </div>

                <!-- Tags -->
                ${c.tags && c.tags.length > 0 ? `
                  <div class="flex flex-wrap gap-2 mb-4">
                    ${c.tags.map(tag => `
                      <span class="px-2 py-1 bg-primary/10 text-primary text-xs font-medium rounded">
                        ${tag}
                      </span>
                    `).join('')}
                  </div>
                ` : '<div class="mb-4"></div>'}

                <!-- Actions -->
                <div class="mt-auto flex flex-col sm:flex-row gap-3">
                  <a href="/${c.file_path}" download
                     class="flex-1 flex items-center justify-center gap-2 bg-primary hover:bg-primary-dark text-white px-4 py-2.5 rounded-lg font-medium transition shadow-sm hover:shadow-md">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                  </a>
                </div>

                <!-- Share -->
                <div class="mt-3 pt-3 border-t border-gray-100">
                  <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-gray-600 uppercase tracking-wider">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è:</span>
                    <div class="flex gap-2">
                      <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}"
                         target="_blank"
                         class="w-8 h-8 flex items-center justify-center rounded bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold transition"
                         title="Facebook">f</a>
                      <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(c.name)}&url=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}"
                         target="_blank"
                         class="w-8 h-8 flex items-center justify-center rounded bg-sky-500 hover:bg-sky-600 text-white text-sm transition"
                         title="Twitter">ùïè</a>
                      <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}"
                         target="_blank"
                         class="w-8 h-8 flex items-center justify-center rounded bg-blue-700 hover:bg-blue-800 text-white text-xs font-semibold transition"
                         title="LinkedIn">in</a>
                      <a href="https://t.me/share/url?url=${encodeURIComponent(window.location.origin + '/cases?id=' + c.id)}&text=${encodeURIComponent(c.name)}"
                         target="_blank"
                         class="w-8 h-8 flex items-center justify-center rounded bg-sky-400 hover:bg-sky-500 text-white text-lg transition"
                         title="Telegram">‚úà</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Initialize
    loadTags();
    loadCases();
  </script>
</body>
</html>
